#!/usr/bin/env python3\n\nimport re\n\ndef escape_markdown_v2(text):\n    # Define characters that MUST be escaped in MarkdownV2\n    # List: _ * [ ] ( ) ~ ` > + - = { } . ! # | \\\n    # Ensure these are properly escaped for the regex pattern itself.\n    # For example, '[' needs to be '\[' in the regex pattern.\n    # '\\' needs to be '\\\\' in the regex pattern.\n    \n    # Using raw string for the pattern and properly escaping each character\n    chars_to_escape = [\n        '_', '*', '[', ']', '(', ')', '~', '`', '>', '+', '-', '=', '{', '}',\n        '.', '!', '#', '|', '\\'\n    ]\n    \n    # Properly escape each character for use within a regex character set []\n    escaped_chars_for_regex = [re.escape(char) for char in chars_to_escape]\n    \n    # Join them with '|' for a pattern that matches any of these characters\n    pattern = '|'.join(escaped_chars_for_regex)\n    \n    # The substitution pattern: r'\\\1' inserts a literal backslash followed by the matched character.\n    # The outer '\\\\' in the string literal becomes '\' in the regex engine.\n    # The '\1' then refers to the first capturing group, which is the matched character.\n    return re.sub(f'({pattern})', r'\\\\\\1', text)\n\n# --- Test with sample data ---\n\n# Sample job data that might contain special characters\nsample_job = {\n    \"title\": \"Software Engineer (Remote) v2.0!\",\n    \"company\": \"Tech Solutions Inc.*\",\n    \"country\": \"USA\",\n    \"language\": \"English\",\n    \"sector\": \"tech\",\n    \"link\": \"https://example.com/jobs/tech-solutions-software-engineer\",\n    \"requisitos\": {\n        \"ingles\": \"fluente (with extras!)\",\n        \"faculdade\": \"sim*\",\n        \"experiencia_anos\": 2,\n        \"descricao\": \"A great opportunity in [tech].\"\n    }\n}\n\n# --- Format and print the escaped message ---\n# Simulate the job_to_post structure expected by format_job_message\n# The job_to_post needs at least 'title', 'company', 'country', 'language', 'sector', 'salario_usd_mes', 'requisitos', 'official_link'\n\njob_to_format = {\n    'title': escape_markdown_v2(sample_job['title']),\n    'company': escape_markdown_v2(sample_job['company']),\n    'country': escape_markdown_v2(sample_job['country']),\n    'sector': escape_markdown_v2(sample_job['sector']),\n    'salario_usd_mes': sample_job.get('salario_usd_mes', 'N/A'),\n    'requisitos': {\n        'ingles': escape_markdown_v2(sample_job['requisitos'].get('ingles', 'N/A')),\n        'faculdade': escape_markdown_v2(sample_job['requisitos'].get('faculdade', 'N/A')),\n        'experiencia_anos': sample_job['requisitos'].get('experiencia_anos'),\n        'descricao': escape_markdown_v2(sample_job['requisitos'].get('descricao', 'N/A'))\n    },\n    'official_link': escape_markdown_v2(sample_job['link'])\n}\n\n# Mock the format_job_message function structure for direct testing\n# This is to isolate the escaping logic.\n\ndef mock_format_job_message(job):\n    title = job.get('title', 'N/A')\n    company = job.get('company', 'N/A')\n    country = job.get('country', 'N/A')\n    sector = job.get('sector', 'N/A')\n    salary_usd_month = job.get('salario_usd_mes', 'N/A')\n    \n    reqs = job.get('requisitos', {})\n    description = reqs.get('descricao', 'N/A')\n    \n    requirements = []\n    \n    ingles = reqs.get('ingles', 'N/A')\n    if ingles != 'N/A':\n        requirements.append(f\"â€¢ InglÃªs: {ingles}\")\n    \n    faculdade = reqs.get('faculdade', 'N/A')\n    if faculdade != 'N/A':\n        requirements.append(f\"â€¢Faculdade: {faculdade.capitalize()}\")\n    \n    experiencia_anos = reqs.get('experiencia_anos')\n    if experiencia_anos is not None:\n        exp_text = f\"Sim, {experiencia_anos}+ anos\" if experiencia_anos > 0 else \"NÃ£o\"\n        requirements.append(f\"â€¢ ExperiÃªncia: {exp_text}\")\n    else:\n        requirements.append(\"â€¢ ExperiÃªncia: Qualquer um\")\n\n    message = f\"ğŸ¯ *{title}* {company}\\n\"\n    message += f\"ğŸ“ {country}\\n\"\n    message += f\"ğŸ’° USD ${salary_usd_month}/mÃªs (Estimado)\\n\"\n    message += f\"âœ“ {description}\\n\\nRequisitos:\\n\" + \"\\n\".join(requirements)\n    message += f\"\\nAPLICAR: {job.get('official_link', '#')}\"\n    \n    return message\n\n\nformatted_message = mock_format_job_message(job_to_format)\nprint(\"---\")\nprint(formatted_message)\nprint(\"---\")\n\n